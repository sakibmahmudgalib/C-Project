This code is edited by partnar.